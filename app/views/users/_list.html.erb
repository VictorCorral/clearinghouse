<%# Optional locals: %>
<% show_provider ||= false %>

<table>
  <tr>
    <th>Name</th>
    <th><% if show_provider %>Provider<% end %></th>
    <th>Title</th>
    <th>Email</th>
    <th>Phone</th>
    <th></th>
    <th></th>
  </tr>

<% users.each do |user| %>
  <%# Don't show inactive users unless administrator %>
  <% if user.active or can? :edit, user %>
  <tr>
    <td><%= link_to user.name, user_path(user)%></td>
    <td>
      <% if show_provider %>
        <% if user.provider %>
          <%= link_to user.provider.name, provider_path(user.provider) %>
        <% else %>
          <span style="color: #aaa">(none)</span>
        <% end %>
      <% end %>
    </td>
    <td><%= user.title %></td>
    <td><%= link_to user.email, "mailto:#{user.email}" %></td>
    <td><%= user.phone %></td>
    <% if can? :edit, user %>
      <td><%= link_to 'Edit User', edit_user_path(user) %></td>
      <% if user.active? %>
        <td><%= link_to 'Deactivate User', deactivate_user_path(user),
                        :method=>:post %></td>
      <% else %>
        <td><%= link_to 'Activate User', activate_user_path(user),
                        :method=>:post %></td>
      <% end %>
    <% end %>
  </tr>
  <% end %>
<% end %>
</table>
